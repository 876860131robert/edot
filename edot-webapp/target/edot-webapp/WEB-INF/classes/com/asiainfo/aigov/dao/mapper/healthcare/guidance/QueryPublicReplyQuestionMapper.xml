<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.asiainfo.aigov.dao.healthcare.guidance.QueryPublicReplyQuestionMapper">
  <resultMap id="BaseResultMap" type="com.asiainfo.aigov.model.healthcare.guidance.QueryPublicReplyQuestion">
    <id column="REPLY_QUESTION_ID" jdbcType="VARCHAR" property="replyQuestionId" />
    <result column="CREATE_ID" jdbcType="VARCHAR" property="createId" />
    <result column="CREATE_NAME" jdbcType="VARCHAR" property="createName" />
    <result column="CREATE_IMG" jdbcType="VARCHAR" property="createImg" />
    <result column="CREATE_DATE" jdbcType="TIMESTAMP" property="createDate" />
    <result column="STATE" jdbcType="VARCHAR" property="state" />
    <result column="LIKE_NUM" jdbcType="DECIMAL" property="likeNum" />
    <result column="FACT_CONTENT" jdbcType="VARCHAR" property="factContent" />
    <result column="PARENT_ID" jdbcType="VARCHAR" property="parentId" />
    <result column="IMG1" jdbcType="VARCHAR" property="img1" />
    <result column="IMG2" jdbcType="VARCHAR" property="img2" />
    <result column="IMG3" jdbcType="VARCHAR" property="img3" />
    <result column="IMG4" jdbcType="VARCHAR" property="img4" />
    <result column="IMG5" jdbcType="VARCHAR" property="img5" />
    <result column="IMG6" jdbcType="VARCHAR" property="img6" />
    <result column="IMG7" jdbcType="VARCHAR" property="img7" />
    <result column="IMG8" jdbcType="VARCHAR" property="img8" />
    <result column="IMG9" jdbcType="VARCHAR" property="img9" />
    <result column="REPLY_NUM" jdbcType="DECIMAL" property="replyNum" />
    <result column="ADDRESS" jdbcType="VARCHAR" property="address" />
    <result column="LAT" jdbcType="VARCHAR" property="lat" />
    <result column="LNG" jdbcType="VARCHAR" property="lng" />
    <result column="TYPE" jdbcType="DECIMAL" property="type" />
    <result column="PATIENTS_ID" jdbcType="VARCHAR" property="patientsId" />
    <result column="DOCTOR_ID" jdbcType="VARCHAR" property="doctorId" />
    <result column="IS_HEALTH_RECORD" jdbcType="VARCHAR" property="isHealthRecord" />
    <result column="HAS_NEW_REPLY" jdbcType="VARCHAR" property="hasNewReply" />
    <result column="PATIENT_NAME" jdbcType="VARCHAR" property="patientName" />
  </resultMap>
  
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Apr 27 18:33:58 CST 2017.
    -->
    REPLY_QUESTION_ID, CREATE_ID, CREATE_NAME, CREATE_IMG, CREATE_DATE, STATE, LIKE_NUM, 
    FACT_CONTENT, PARENT_ID, IMG1, IMG2, IMG3, IMG4, IMG5, IMG6, IMG7, IMG8, IMG9, REPLY_NUM, 
    ADDRESS, LAT, LNG, TYPE, PATIENTS_ID, DOCTOR_ID, IS_HEALTH_RECORD
  </sql>
  
  <select id="countMyQuestion" parameterType="java.lang.String" resultType="java.lang.Integer">
    select count(*) from PUBLIC_REPLY_QUESTION
     where type in('1','2') and parent_id is null and create_id=#{userId,jdbcType=VARCHAR}
  </select>
  <select id="queryMyQuestionWithRowbounds" parameterType="java.lang.String" resultMap="BaseResultMap">
    select t.*,
       case
         when exists
          (select 1
                 from public_reply_question x
                where x.state = '1'
                  and x.create_date > nvl(t.last_browse_time, t.create_date)
                  and x.parent_id = t.reply_question_id) then
          '1'
         else
          '0'
       end has_new_reply,
       (select y.patient_name
          from public_patients y
         where t.patients_id = y.patient_id) patient_name		    
     from PUBLIC_REPLY_QUESTION t
      where type in('1','2') and parent_id is null and create_id=#{userId,jdbcType=VARCHAR}     
      order by CREATE_DATE DESC
  </select>
</mapper>